<h1>
  Export
</h1>

<h2>
  Exportáladnó(nem tudom van-e ilyen szó) adatok
</h2>

<div class="container">
  <div class="content">
    <div class="sexclass">
      <div>
        <label class="text" for="sex">Páciens neme</label>
      </div>
      <div>
        <select class="droptextbox" name="sex" id="sex" [(ngModel)]="filter.Sex">
        <option value="Férfi">Férfi</option>
        <option value="Nő">Nő</option>
        <option value="Kumulált">Kumulált</option>
        </select>
      </div>
    </div>

    <div class="ageclass">      
      <div>
        <label class="text" for="age">Páciens kora</label>
      </div>
      <div>
        <input class="droptextbox" type="number" id="agefrom" name="agefrom" min="1" [(ngModel)]="filter.AgeFrom"><label style="margin-right: 20px;"> - tól</label>
        <input class="droptextbox" type="number" id="ageto" name="ageto" min="1" [(ngModel)]="filter.AgeTo"><label> - ig</label>
      </div>
    </div>
  

    <div class="validclass">
      <div>
        <label class="text"> Validált</label>
     </div>
      <div>
        <select class="droptextbox" name="validity" id="validity" [(ngModel)]="filter.Validated">
        <option value="validált">Validált</option>
        <option value="nem validált">Nem validált</option>
        <option value="kumulált">Kumulált</option>
        </select>
      </div>
    </div>
    
    <div class="source"  *ngIf="loginService.hasAnyGroup([portaladmin, portalvezeto, kutatoorvos])">
      <div>
        <label style="margin-bottom: 0;" for="source">Forrás:</label>
      </div>
      <div>
        <input class="droptextbox" type="text" id="source" name="source" [(ngModel)]="filter.Source">
      </div>
    </div>



    <div class="source">
      <label style="margin-bottom: 0;" for="datefrom">Dátum szűrés</label>
      <form>      
        <input class="droptextbox" type="date" id="datefrom" name="datefrom" [(ngModel)]="filter.DateFrom" > - tól       
        <input class="droptextbox" type="date" id="dateto" name="dateto"  [(ngModel)]="filter.DateTo" > - ig
      </form>
    </div>


    <p style="margin-top: 40px;">Marker hozzáadása vagy egy mentett szürő kiválasztása</p>

    <div>
  
     <button style="z-index: 0;" id="markerbutton" (click)="toggleContent('marker')" [ngClass]="{'active-button': markerActive, 'inactive-button': !markerActive }">Marker hozzáadása</button>
     <button (click)="toggleContent('filter')" [ngClass]="{'active-button': filterActive, 'inactive-button': !filterActive }">Filter kiválasztása</button>

      <div class="markerfiltercontent">
       <div *ngIf="markerActive">
        <div>
          <label class="text">Marker</label>
        </div>
        <div style="display: flex;">
          <select class="droptextbox" type="text" id="markers" name="markers" [(ngModel)]="marker">
            <ng-container *ngFor="let marker of markers">
              <option value="{{marker}}">{{marker}}</option>
            </ng-container>
          </select>
          <button id="addmarkerbutton" (click)="getMarker()">Hozzáadás</button>
        </div>
      </div>  
    
      <div *ngIf="filterActive">
        <div>
          <p>Meglévő szűrő lekérdezése</p>
        </div>
        <div style="display: flex;" >
          <div style="margin-right: 40px; margin-bottom: 40px;">
            <label class="text">Szűrők lekérdezése</label>
            <button (click)="getFilters()">Lekérdezés</button>
          </div>
          <div>
            <label class="text">Válasszon szürőt</label>
            <select class="droptextbox" type="text" id="filters" name="filters" [(ngModel)]="filter">
              <ng-container *ngFor="let filter of savedfilters">
                <option [ngValue]="filter.Filter">{{filter.FilterName}}</option>
              </ng-container>
            </select>
          </div>
          </div>
        </div>
      </div>
    </div>
  
  

 
    <div class="content2">
      <ng-container *ngIf="filter.Illnesses && filter.Illnesses.length > 0; else noMarkers">
        <p style="border-bottom: solid 3px #64afffa6; display: flex; align-items: center; padding-bottom: 5px; margin-top: 5px;">Hozzáadott Markerek</p>
        <div style="max-height: 265px; overflow-y: auto;">
          <div *ngFor="let illness of filter.Illnesses; let i = index" style="border-bottom: solid 3px #b8b8b8a6; display: flex; align-items: center; padding-bottom: 5px; margin-top: 5px;">
            <div style="flex-grow: 1;">
              <p style="margin: 0;">{{ illness }}</p>
            </div>
            <div style="margin-left: auto;">
              <button (click)="removeMarker(illness)">Törlés</button>
            </div>
          </div>
        </div>
        <div *ngIf="filter.Illnesses.length > 5">
          <p style=" margin-top: 20px; opacity: 70%;">(További Markerek megtekintéséhez görgessen lefele(vagy valami szöveget ide lehet irni))</p>
        </div>
      </ng-container>
      <ng-template #noMarkers>
        <p style="border-bottom: solid 3px #64afffa6; display: flex; align-items: center; padding-bottom: 5px; margin-top: 5px;">Még nem adott hozzá Markert</p>
      </ng-template>
    </div>  
  
    <button id="okebutton" *ngIf="markerActive" (click)="finish()">Kész</button>  
    <button id="okebutton" *ngIf="filterActive" (click)="finish()">Kész</button>  

    <!--TABLE-->

    <div class="table">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort>
      

      <!-- Position Column -->
       
      <ng-container matColumnDef="sex">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Nem</th>
        <td mat-cell *matCellDef="let export">{{ export.Sex }}</td>
      </ng-container>

      <ng-container matColumnDef="age">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Kor</th>
        <td mat-cell *matCellDef="let export">{{ export.Age }}</td>
      </ng-container>

      <!-- <ng-container matColumnDef="markers" >
        <th mat-header-cell *matHeaderCellDef mat-sort-header>markerek </th>
        <td mat-cell *matCellDef="let export"> {{export.Markers[0].Names[0]}} </td>
      </ng-container> -->

      <ng-container matColumnDef="markers" >
        <th mat-header-cell *matHeaderCellDef mat-sort-header>markerek </th>
        <td mat-cell *matCellDef="let export"> {{ getMarkerNames(export) }} </td>
      </ng-container>

      <ng-container matColumnDef="hospitalized">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Kórház esély %</th>
        <td mat-cell *matCellDef="let export">{{ export.Hospitalized }}</td>
      </ng-container>

      <ng-container matColumnDef="dead">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Halálozási esély %</th>
        <td mat-cell *matCellDef="let export">{{ export.Dead }}</td>
      </ng-container>

      <ng-container matColumnDef="count">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Összes adat</th>
        <td mat-cell *matCellDef="let export">{{ export.Count }}</td>
      </ng-container>

      <ng-container matColumnDef="validated">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Validált/nem validált</th>
        <td mat-cell *matCellDef="let export">{{ export.Validated }}</td>
      </ng-container>

      <ng-container matColumnDef="source">
        <th mat-header-cell *matHeaderCellDef> Forrás </th>
        <td mat-cell *matCellDef="let export"> {{export.Source}} </td>
      </ng-container>
      <!--   a kövi kettő majd a dátumos lesz               -->
      <ng-container matColumnDef="datefrom">
        <th mat-header-cell *matHeaderCellDef> Dátum -tól </th>
        <td mat-cell *matCellDef="let export"> {{export.DateFrom}} </td>
      </ng-container>

      <ng-container matColumnDef="dateto">
        <th mat-header-cell *matHeaderCellDef> Dátum -ig </th>
        <td mat-cell *matCellDef="let export"> {{export.DateTo}} </td>
      </ng-container>
      

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>
      <mat-paginator #paginator [pageSizeOptions]="pageSizeOptions" showFirstLastButtons></mat-paginator> 

    </div>

    <div class="exportbutton">
      <p>Exportálja a táblázatot</p>
      <button (click)="export()"> XLSX Export</button>
    </div>
    <div class="source">
      <div>
        <p>Jelenlegi Szűrő mentése</p>
      </div>
      <div>
        <label style="margin-bottom: 0; width: 200px;" for="filtername">Adja meg a szürő nevét a mentéshez</label>
      </div>    
      <input class="droptextbox" type="text" id="filtername" name="filtername" [(ngModel)]="filtername">    
      <button id="filtersavebutton" (click)="saveFilter()">Szűrő mentése</button>
    </div>  
    
  </div>
</div>