<h1>
  Export
</h1>

<h2>
  Exportáladnó(nem tudom van-e ilyen szó) adatok
</h2>

<div class="container">

  <div class="content">
    <div class="container2">
      <div class="sexclass">
        <div>
          <label class="text" for="sex">Páciens neme</label>
        </div>
        <div>
          <select class="droptextbox" name="sex" id="sex" [(ngModel)]="filter.Sex" title="Kérem válasszon.">
          <option value="Férfi">Férfi</option>
          <option value="Nő">Nő</option>
          <option value="Kumulált">Kumulált</option>
          </select>
        </div>
      </div>
  
      <div class="ageclass">      
        <div>
          <label class="text" for="age">Páciens kora</label>
        </div>
        <div>
          <input class="droptextbox" type="number" id="agefrom" name="agefrom" min="1" [(ngModel)]="filter.AgeFrom" title="Kérem töltse ki a mezőt"> - tól
        
          <input class="droptextbox" type="number" id="ageto" name="ageto" min="1" [(ngModel)]="filter.AgeTo" title="Kérem töltse ki a mezőt"> - ig
        </div>
      </div>
    </div>

    <div class="container2">    
      <div class="validclass">
        <div>
          <label class="text"> Validált</label>
      </div>
        <div>
          <select class="droptextbox" name="validity" id="validity" [(ngModel)]="filter.Validated" title="Kérem válasszon">
          <option value="Validált">Validált</option>
          <option value="Nem validált">Nem validált</option>
          <option value="Kumulált">Kumulált</option>
          </select>
        </div>
      </div>
    
      <div class="source"  *ngIf="loginService.hasAnyGroup([portaladmin, portalvezeto, kutatoorvos])">
        <div>
          <label for="source">Forrás:</label>
        </div>
        <div>
          <input class="droptextbox" type="text" id="source" name="source" [(ngModel)]="filter.Source" placeholder="???" title="Kérem töltse ki a mezőt">
        </div>
      </div>
    </div>

    <div class="container2">
      <div class="source">
        <label for="datefrom">Dátum szűrés</label>
        <form>      
          <input class="droptextbox" type="date" id="datefrom" name="datefrom" [(ngModel)]="filter.DateFrom" title="Kérem válasszon"> - tól       
          <input class="droptextbox" type="date" id="dateto" name="dateto"  [(ngModel)]="filter.DateTo" title="Kérem válasszon"> - ig
        </form>
      </div>

      <div class="relativeclass">
        <div>
          <label class="text" for="relative">Relatív idő választása</label>
        </div>
        <div>
          <select class="droptextbox" name="relative" id="relative" [(ngModel)]="filter.RelativeDate" title="Kérem válasszon">
          <option value="yesterday">tegnap</option>
          <option value="this_week">ez a hét</option>
          <option value="last_week">múlt hét</option>
          <option value="last_month">múlt hónap</option>
          <option value="last_3_months">utolsó 3 hónap</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  

  <div class="content2">

    <div class="container3">
      <p>Marker hozzáadása vagy egy mentett szürő kiválasztása</p>
     <button id="markerbutton" (click)="toggleContent('marker')" [ngClass]="{'active-button': markerActive, 'inactive-button': !markerActive }">Marker hozzáadása</button>
     <button (click)="toggleContent('filter')" [ngClass]="{'active-button': filterActive, 'inactive-button': !filterActive }">Filter kiválasztása</button>
    </div>
    <div *ngIf="markerActive" class="container3">
      <div >        
          <label class="text">Marker</label>
      </div>
      <div>
        <select class="droptextbox" type="text" id="markers" name="markers" [(ngModel)]="marker" title="Kérem válasszon">
          <ng-container *ngFor="let marker of markers">
            <option value="{{marker}}">{{marker}}</option>
          </ng-container>
        </select>
        <button id="addmarkerbutton" (click)="getMarker()">Hozzáadás</button>
      </div>
    </div>  
    
    <div *ngIf="filterActive" class="container3">
      <div >
        <div>
          <p>Meglévő szűrő lekérdezése</p>
        </div>
        <div style="display: flex;" >
          <div>
            <label class="text">Válasszon a mentett filterek közül!</label>
            <select class="droptextbox" type="text" id="filters" name="filters"  [(ngModel)]="filter" title="Kérem válasszon" >
              <ng-container *ngFor="let filter of savedfilters">                
                <option [ngValue]="filter.Filter">{{filter.FilterName}}</option>
              </ng-container>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  
  

 
    <div class="content3">
      <ng-container *ngIf="filter.Illnesses && filter.Illnesses.length > 0; else noMarkers">
        <p style="border-bottom: solid 3px #64afffa6; display: flex; align-items: center; padding-bottom: 5px; margin-top: 5px;">Hozzáadott Markerek</p>
        <div style="max-height: 265px; overflow-y: auto;">
          <div *ngFor="let illness of filter.Illnesses; let i = index" style="border-bottom: solid 3px #b8b8b8a6; display: flex; align-items: center; padding-bottom: 5px; margin-top: 5px;">
            <div style="flex-grow: 1;">
              <p style="margin: 0;">{{ illness }}</p>
            </div>
            <div style="margin-left: auto;">
              <button (click)="removeMarker(illness)">Törlés</button>
            </div>
          </div>
        </div>
        <div *ngIf="filter.Illnesses.length > 5">
          <p style=" margin-top: 20px; opacity: 70%;">(További Markerek megtekintéséhez görgessen lefele(vagy valami szöveget ide lehet irni))</p>
        </div>
      </ng-container>
      <ng-template #noMarkers>
        <p style="border-bottom: solid 3px #64afffa6; display: flex; align-items: center; padding-bottom: 5px; margin-top: 5px;">Még nem adott hozzá Markert</p>
      </ng-template>
    </div>  
  
    <button id="okebutton" *ngIf="markerActive" (click)="finish()">Kész</button>  
    <button id="okebutton" *ngIf="filterActive" (click)="finish()">Kész</button>  

    <!--TABLE-->

    <div class="table">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort>
      

      <!-- Position Column -->
       
      <ng-container matColumnDef="sex">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Nem</th>
        <td mat-cell *matCellDef="let export">{{ export.Sex }}</td>
      </ng-container>

      <ng-container matColumnDef="age">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Kor</th>
        <td mat-cell *matCellDef="let export">{{ export.Age }}</td>
      </ng-container>

      <!-- <ng-container matColumnDef="markers" >
        <th mat-header-cell *matHeaderCellDef mat-sort-header>markerek </th>
        <td mat-cell *matCellDef="let export"> {{export.Markers[0].Names[0]}} </td>
      </ng-container> -->

      <ng-container matColumnDef="markers" >
        <th mat-header-cell *matHeaderCellDef mat-sort-header>markerek </th>
        <td mat-cell *matCellDef="let export"> {{ getMarkerNames(export) }} </td>
      </ng-container>

      <ng-container matColumnDef="hospitalized">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Kórház esély %</th>
        <td mat-cell *matCellDef="let export">{{ export.Hospitalized }}</td>
      </ng-container>

      <ng-container matColumnDef="dead">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Halálozási esély %</th>
        <td mat-cell *matCellDef="let export">{{ export.Dead }}</td>
      </ng-container>

      <ng-container matColumnDef="count">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Összes adat</th>
        <td mat-cell *matCellDef="let export">{{ export.Count }}</td>
      </ng-container>

      <ng-container matColumnDef="validated">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Validált/nem validált</th>
        <td mat-cell *matCellDef="let export">{{ export.Validated }}</td>
      </ng-container>

      <ng-container matColumnDef="source">
        <th mat-header-cell *matHeaderCellDef> Forrás </th>
        <td mat-cell *matCellDef="let export"> {{export.Source}} </td>
      </ng-container>
      <!--   a kövi kettő majd a dátumos lesz               -->
      <ng-container matColumnDef="datefrom">
        <th mat-header-cell *matHeaderCellDef> Dátum -tól </th>
        <td mat-cell *matCellDef="let export"> {{export.DateFrom}} </td>
      </ng-container>

      <ng-container matColumnDef="dateto">
        <th mat-header-cell *matHeaderCellDef> Dátum -ig </th>
        <td mat-cell *matCellDef="let export"> {{export.DateTo}} </td>
      </ng-container>
      

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>
      <mat-paginator #paginator [pageSizeOptions]="pageSizeOptions" showFirstLastButtons></mat-paginator> 

    </div>

    <div style="display: flex; justify-content: space-around; text-align: center;">
      <div class="savebutton">      
        <p style="align-items: start;">Jelenlegi Szűrő mentése</p>        
        <div>        
          <input style="margin-bottom: 5px;" class="droptextbox" type="text" id="filtername" name="filtername" [(ngModel)]="filtername" placeholder="Új szürő" title="Kérem töltse ki a mezőt">    
          <button id="filtersavebutton" (click)="saveFilter()">Szűrő mentése</button>
        </div> 
        <p>Adja meg a szürő nevét a mentéshez</p>
      </div> 
      
  
      <div class="diagrambutton">
        <p>Nézze meg a szűréshez tartozó diagrammot!</p>      
        <button style="margin-bottom: 5px;" (click)="goDiagram()">Diagram - PIE<mat-icon>
          pie_chart</mat-icon></button>
        <p>Diagram megnyitása</p>
      </div>
      <div class="diagrambutton">
        <p>Nézze meg a szűréshez tartozó diagrammot!</p>      
        <button style="margin-bottom: 5px;" (click)="goDiagram()">Diagram - LINE<mat-icon>
          show_chart</mat-icon></button>
        <p>Diagram megnyitása</p>
      </div>
      <div class="diagrambutton">
        <p>Nézze meg a szűréshez tartozó diagrammot!</p>      
        <button style="margin-bottom: 5px;" (click)="goDiagram()">Diagram - BAR<mat-icon>
          table_chart</mat-icon></button>
        <p>Diagram megnyitása</p>
      </div>

      <div class="exportbutton">
        <p>Exportálja a szűrt táblázatot</p>      
        <button style="margin-bottom: 5px;" (click)="export()">Export</button>
        <p>XLSX Export Szűrt adatok</p>
      </div>

      <div class="ratestbutton">
        <p>Exportálja a teljes eredmény adatokat</p>      
        <button style="margin-bottom: 5px;" (click)="rates()">Export</button>
        <p> XLSX Export Teljes eredmény adatok</p>
      </div>    
    </div>       
  
</div>

